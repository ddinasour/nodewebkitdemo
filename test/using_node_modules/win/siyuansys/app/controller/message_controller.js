var helpers = require('./_helpers');
var fs = require('fs');

module.exports = {
  //create: function(Siyuan,$,Mustache) {
  create: function() {
        console.log("message create");
        //console.log($("#message_title").val());
        //console.log($("#message_body").val());
        Siyuan.siyuan(function(err,db){
           db.models.message.create({
            // title: "huang", 
            //body: "chuanwen"
            title: $("#message_title").val(), 
            body: $("#message_body").val()
           }, function (err, message) {
             if (err) throw err;
               db.models.message.find().limit(10).order('-id').all(function (err, messages) {
                 if (err) return next(err);

                 var items = messages.map(function (m) {
                   return m.serialize();
                 });
                console.log(items);

               });
console.log(fs);
                var file = fs.readFileSync("/Users/huangcw/mydev/github/nodewebkitdemo/test/public/node_modules/siyuansys/app/views/message/create.html", "utf8");
                var date = new Date();
                var view = {
                    title: "Joe",
                    timeaa :"?date:"+date
                };

                var output = Mustache.render(file, view);
                $("#main_area").html(output);

             db.close()
             console.log("Done!");
           });
        });
        
    }
};
